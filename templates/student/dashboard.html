<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Sound Effects -->
<audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3"></audio>
<audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<style>
/* ===== YOUR ORIGINAL CSS (UNCHANGED) ===== */
:root{
  --glass: rgba(255,255,255,0.15);
  --border: rgba(255,255,255,0.25);
  --blue:#2563eb;
  --green:#16a34a;
  --orange:#f59e0b;
  --red:#dc2626;
  --purple:#7c3aed;
}

body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background: linear-gradient(-45deg,#667eea,#764ba2,#6dd5ed,#2193b0);
  background-size:400% 400%;
  animation: gradientBG 15s ease infinite;
  color:white;
}

@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

.sidebar{
  width:260px;
  backdrop-filter: blur(18px);
  background: var(--glass);
  border-right:1px solid var(--border);
  position:fixed;
  height:100%;
  padding:25px 20px;
  display:flex;
  flex-direction:column;
}

.sidebar a{
  display:flex;
  padding:12px;
  border-radius:12px;
  color:white;
  text-decoration:none;
  margin-bottom:12px;
  transition:.3s;
}

.sidebar a:hover,
.sidebar a.active-link{
  background:rgba(255,255,255,0.25);
  transform:translateX(5px);
}

.sidebar-bottom{ margin-top:auto; }

.logout-btn{
  background:var(--red);
  text-align:center;
  border-radius:12px;
  padding:10px;
  color:white;
  text-decoration:none;
}

.main{ margin-left:260px; padding:40px; }

.card-custom, .game-box{
  backdrop-filter: blur(20px);
  background: var(--glass);
  border:1px solid var(--border);
  border-radius:20px;
  padding:25px;
  margin-bottom:25px;
  box-shadow:0 10px 30px rgba(0,0,0,0.25);
  transition:0.3s;
}

.card-custom:hover, .game-box:hover{
  transform:scale(1.02);
}

.stat-card{
  border-radius:20px;
  padding:25px;
  text-align:center;
  backdrop-filter: blur(15px);
  background:rgba(255,255,255,0.2);
}

.ring{
  width:170px;
  height:170px;
  border-radius:50%;
  background:conic-gradient(var(--blue) var(--percent), rgba(255,255,255,0.2) 0);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  font-weight:bold;
  margin:auto;
}

.dashboard-section{ display:none; opacity:0; transition:0.4s; }
.dashboard-section.active{ display:block; opacity:1; }

.memory-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}

.memory-card{
  background:white;
  color:black;
  padding:20px;
  text-align:center;
  font-weight:bold;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>

<body>

{% if performance %}
{% set p = performance[0] %}
{% endif %}

<div class="sidebar">
  <h2>EduTrack</h2>
  <a href="#" onclick="showSection('studentInfo',this)">ğŸ‘¤ Student Info</a>
  <a href="#" onclick="showSection('attendance',this)">ğŸ“ˆ Attendance</a>
  <a href="#" onclick="showSection('alerts',this)">ğŸš¨ Alerts</a>
  <a href="#" onclick="showSection('games',this)">ğŸ® Games</a>
 <a href="#" onclick="showSection('feedback',this)">â­Feedback</a>
  <a href="#" onclick="showSection('applyforleave',this)">ğŸ“Apply For Leave</a>

  {% if performance %}
  <div class="mt-4 p-3 rounded" style="background:rgba(0,0,0,0.3);">
    <h6>ğŸ¤– AI Dropout Prediction</h6>
    <small>
      {% if p.avg|int < 60 %}
        High Risk ğŸš¨
      {% elif p.avg|int < 75 %}
        Medium Risk âš 
      {% else %}
        Low Risk âœ…
      {% endif %}
    </small>
  </div>
  {% endif %}

  <div class="sidebar-bottom mt-4">
    <a href="/logout" class="logout-btn">ğŸšª Logout</a>
  </div>
</div>

<div class="main">

{% if performance %}

<!-- STUDENT INFO -->
<div id="studentInfo" class="dashboard-section active">
  <h2 class="mb-4">Welcome, {{ p.name }} ğŸ‘‹</h2>

  <!-- Academic Details Card (NEW ADDED ONLY) -->
  <div class="card-custom mb-4">
    <h5 class="mb-3">ğŸ“ Academic Details</h5>
    <div class="row">
      <div class="col-md-4">
        <p><strong>Standard:</strong> {{ p.standard }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>Division:</strong> {{ p.division }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>Roll No:</strong> {{ p.roll_no }}</p>
      </div>
    </div>
  </div>

  <!-- Performance Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="stat-card">
        <h6>ğŸ“Š Attendance</h6>
        <h3>{{ p.avg|int }}%</h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-card">
        <h6>ğŸ“ Assignments</h6>
        <h3>{{ p.assignment|int }}</h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-card">
        <h6>ğŸ“š Quiz</h6>
        <h3>{{ p.quiz|int }}</h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-card">
        <h6>âš  Risk</h6>
        <h3>{{ p.risk }}</h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-card">
        <h6>ğŸ† Performance Score</h6>
        <h3>{{ (p.avg|int + p.assignment|int + p.quiz|int)//3 }}%</h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-card">
        <h6>ğŸ“… Month</h6>
        <h3>{{ p.month }}</h3>
      </div>
    </div>
  </div>
</div>

<!-- ATTENDANCE -->
<div id="attendance" class="dashboard-section">
  <div class="card-custom text-center">
    <h4>Attendance Progress</h4>
    <div class="ring" style="--percent: {{ p.avg|int }}%;">
      {{ p.avg|int }}%
    </div>
  </div>
  <div class="card-custom">
    <h4>Attendance Chart</h4>
    <canvas id="attendanceChart"></canvas>
  </div>
</div>

<!-- ALERTS -->
<div id="alerts" class="dashboard-section">
  <div class="card-custom">
    <h4>Alerts</h4>
    {% if p.avg|int < 75 %}
    <div class="alert alert-danger">Attendance below 75%</div>
    {% endif %}
    {% if p.assignment|int < 50 %}
    <div class="alert alert-warning">Low assignment submission</div>
    {% endif %}
    {% if p.quiz|int < 50 %}
    <div class="alert alert-warning">Low quiz performance</div>
    {% endif %}
  </div>
</div>

<!-- GAMES -->
<div id="games" class="dashboard-section">

  <!-- ORIGINAL GAMES (NOT REMOVED) -->
  <div class="game-box mb-4">
    <h4>ğŸ¯ Quick Math Game</h4>
    <p id="question"></p>
    <input type="number" id="answer" class="form-control w-50 mx-auto mb-3">
    <button class="btn btn-light" onclick="checkAnswer()">Submit</button>
    <p id="result" class="mt-3"></p>
    <p><strong>Points:</strong> <span id="points">0</span></p>
  </div>

  <!-- NEW RANDOM GAMES -->
  <div class="game-box">
    <h4>ğŸ® Today's Random Games</h4>
    <div id="randomGames"></div>
  </div>

</div>

{% endif %}
</div>

<script>
/* Section Switch */
function showSection(id){
  document.querySelectorAll(".dashboard-section").forEach(sec=>{
    sec.classList.remove("active");
  });
  document.getElementById(id).classList.add("active");
  document.getElementById("clickSound").play();
}

/* Attendance Chart */
document.addEventListener("DOMContentLoaded", function(){
const ctx = document.getElementById("attendanceChart");
if(ctx){
  new Chart(ctx,{
    type:"bar",
    data:{
      labels:["Attendance"],
      datasets:[{
        label:"Attendance %",
        data:[{{ p.avg|int }}],
        backgroundColor:"#ffffff"
      }]
    },
    options:{scales:{y:{beginAtZero:true,max:100}}}
  });
}
});

/* ORIGINAL MATH GAME */
let points=0;
let num1=Math.floor(Math.random()*10);
let num2=Math.floor(Math.random()*10);
document.getElementById("question").innerText=`What is ${num1} + ${num2}?`;

function checkAnswer(){
  let user=document.getElementById("answer").value;
  if(user==num1+num2){
    points+=10;
    document.getElementById("result").innerText="Correct! ğŸ‰";
    document.getElementById("winSound").play();
  }else{
    document.getElementById("result").innerText="Try Again âŒ";
  }
  document.getElementById("points").innerText=points;
}

/* 20 RANDOM GAMES */
const games=[
"Word Scramble","Capital Quiz","Guess Number","Even or Odd","Memory Challenge",
"Riddle Time","Science Quiz","Typing Speed","Color Guess","Brain Teaser",
"Quick Multiply","Spell Check","GK Quiz","Find Pattern","Odd One Out",
"True or False","History Quiz","Animal Quiz","Logic Puzzle","Math Challenge"
];

function loadGames(){
  let shuffled=[...games].sort(()=>0.5-Math.random());
  let selected=shuffled.slice(0,2);
  let container=document.getElementById("randomGames");
  container.innerHTML="";
  selected.forEach(game=>{
    container.innerHTML+=`
      <div class="mb-3 p-3 bg-light text-dark rounded">
        <h5>${game}</h5>
        <button class="btn btn-primary mt-2" onclick="playGame('${game}')">Play Now</button>
      </div>
    `;
  });
}

function playGame(game){
  document.getElementById("clickSound").play();
  const container=document.getElementById("randomGames");

  let questions={
    "Word Scramble": {q:"Unscramble: lppa e", a:"apple"},
    "Capital Quiz": {q:"Capital of India?", a:"new delhi"},
    "Guess Number": {q:"Guess a number between 1-5", a:String(Math.floor(Math.random()*5)+1)},
    "Even or Odd": {q:"Is 14 Even or Odd?", a:"even"},
    "Memory Challenge": {q:"Remember this: 321 (type it)", a:"321"},
    "Riddle Time": {q:"I have keys but no locks. What am I?", a:"keyboard"},
    "Science Quiz": {q:"H2O is called?", a:"water"},
    "Typing Speed": {q:"Type this word: education", a:"education"},
    "Color Guess": {q:"Mix red + blue = ?", a:"purple"},
    "Brain Teaser": {q:"5 + 3 Ã— 2 = ?", a:"11"},
    "Quick Multiply": {q:"6 Ã— 7 = ?", a:"42"},
    "Spell Check": {q:"Correct spelling: recieve/receive?", a:"receive"},
    "GK Quiz": {q:"Largest planet?", a:"jupiter"},
    "Find Pattern": {q:"2,4,6,8, ?", a:"10"},
    "Odd One Out": {q:"Apple, Mango, Car, Banana", a:"car"},
    "True or False": {q:"Sun rises from West?", a:"false"},
    "History Quiz": {q:"Who discovered India sea route?", a:"vasco da gama"},
    "Animal Quiz": {q:"Fastest land animal?", a:"cheetah"},
    "Logic Puzzle": {q:"16 + 16 = ?", a:"32"},
    "Math Challenge": {q:"âˆš64 = ?", a:"8"}
  };

  let gameData=questions[game];

  container.innerHTML=`
    <div class="mb-3 p-3 bg-light text-dark rounded">
      <h5>${game}</h5>
      <p>${gameData.q}</p>
      <input id="gameInput" class="form-control mb-2">
      <button class="btn btn-success" onclick="checkGameAnswer('${gameData.a}')">Submit</button>
      <p id="gameResult" class="mt-2"></p>
    </div>
  `;
}

function checkGameAnswer(correct){
  let user=document.getElementById("gameInput").value.toLowerCase().trim();
  if(user===correct.toLowerCase()){
    document.getElementById("gameResult").innerHTML="Correct! ğŸ‰";
    document.getElementById("winSound").play();
  }else{
    document.getElementById("gameResult").innerHTML="Try Again âŒ";
  }
}

document.addEventListener("DOMContentLoaded",loadGames);
</script>

</body>
</html>