<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}EduDrop{% endblock %}</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
{% block head %}{% endblock %}
</head>
<body>

<!-- Skip to main content link for keyboard users -->
<a href="#main-content" class="skip-link">Skip to main content</a>

<div class="layout">

  <!-- Sidebar Overlay (mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
    <a href="{{ url_for('index') }}" class="sidebar-brand" style="text-decoration:none;">
      <i class="bi bi-mortarboard-fill"></i> EduDrop
    </a>

    <nav class="sidebar-nav" aria-label="Dashboard navigation">
      {% block sidebar %}{% endblock %}
    </nav>

    <div class="sidebar-footer">
      <a href="{{ url_for('logout') }}" class="nav-link logout-link" aria-label="Logout">
        <span class="nav-icon"><i class="bi bi-box-arrow-left" aria-hidden="true"></i></span>
        <span>Logout</span>
      </a>
    </div>
  </aside>

  <!-- Main -->
  <div class="main-content">

    <!-- Topbar -->
    <header class="topbar" role="banner">
      <div class="topbar-left">
        <button class="btn-menu" onclick="toggleSidebar()" aria-label="Toggle sidebar menu" aria-expanded="false" id="sidebarToggle">
          <i class="bi bi-list" aria-hidden="true"></i>
        </button>
        <h5>{% block page_title %}Dashboard{% endblock %}</h5>
      </div>
      <div class="topbar-right" style="display:flex;align-items:center;gap:12px;">
        {% block topbar_right %}{% endblock %}
        <div class="lang-switcher">
          <select id="langSelect" onchange="changeLanguage(this.value)" aria-label="Change language">
            <option value="en">English</option>
            <option value="hi">हिन्दी</option>
            <option value="bn">বাংলা</option>
            <option value="te">తెలుగు</option>
            <option value="mr">मराठी</option>
            <option value="ta">தமிழ்</option>
            <option value="gu">ગુજરાતી</option>
            <option value="kn">ಕನ್ನಡ</option>
            <option value="ml">മലയാളം</option>
            <option value="pa">ਪੰਜਾਬੀ</option>
            <option value="or">ଓଡ଼ିଆ</option>
            <option value="as">অসমীয়া</option>
            <option value="ur">اردو</option>
            <option value="sa">संस्कृतम्</option>
            <option value="ne">नेपाली</option>
            <option value="sd">سنڌي</option>
            <option value="ks">कॉशुर</option>
            <option value="doi">डोगरी</option>
            <option value="mai">मैथिली</option>
            <option value="mni-Mtei">মৈতৈলোন্</option>
            <option value="sat">ᱥᱟᱱᱛᱟᱲᱤ</option>
            <option value="gom">कोंकणी</option>
          </select>
        </div>
      </div>
    </header>

    <!-- Flash Messages -->
    <main class="page-content" id="main-content" role="main">
      <div id="flash-container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }} flash-auto-dismiss" role="alert">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      </div>

      {% block content %}{% endblock %}
    </main>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const toggle = document.getElementById('sidebarToggle');
  sidebar.classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('active');
  toggle.setAttribute('aria-expanded', sidebar.classList.contains('open'));
}

function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('active');
  document.getElementById('sidebarToggle').setAttribute('aria-expanded', 'false');
}

// Keyboard: Escape closes sidebar
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && document.getElementById('sidebar').classList.contains('open')) {
    closeSidebar();
  }
});

// Auto-dismiss flash messages after 4 seconds
setTimeout(function() {
  document.querySelectorAll('.flash-auto-dismiss').forEach(function(el) {
    el.style.transition = 'opacity 0.5s';
    el.style.opacity = '0';
    setTimeout(function() { el.remove(); }, 500);
  });
}, 4000);
</script>

{% block scripts %}{% endblock %}

<!-- Google Translate (hidden element) -->
<div id="google_translate_element" style="display:none;"></div>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateInit"></script>
<script>
function googleTranslateInit() {
  new google.translate.TranslateElement({pageLanguage: 'en', autoDisplay: false}, 'google_translate_element');
  // Restore saved language after widget loads
  setTimeout(function() {
    var saved = getCookie('edudrop_lang');
    if (saved && saved !== 'en') {
      triggerTranslate(saved);
    }
    // Sync dropdown
    var sel = document.getElementById('langSelect');
    if (sel && saved) sel.value = saved;
  }, 1000);
}

function changeLanguage(lang) {
  setCookie('edudrop_lang', lang, 365);
  if (lang === 'en') {
    // Reset to English
    var frame = document.querySelector('.goog-te-banner-frame');
    if (frame) {
      var btn = frame.contentDocument.querySelector('.goog-close-link');
      if (btn) btn.click();
    }
    // Also try cookie reset
    setCookie('googtrans', '', -1);
    document.cookie = 'googtrans=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;';
    document.cookie = 'googtrans=; path=/; domain=.' + location.hostname + '; expires=Thu, 01 Jan 1970 00:00:00 UTC;';
    location.reload();
  } else {
    triggerTranslate(lang);
  }
}

function triggerTranslate(lang) {
  var combo = document.querySelector('.goog-te-combo');
  if (combo) {
    combo.value = lang;
    combo.dispatchEvent(new Event('change'));
  }
}

function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = name + '=' + value + ';expires=' + d.toUTCString() + ';path=/';
}

function getCookie(name) {
  var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  return match ? match[2] : null;
}
</script>

</body>
</html>
