<!DOCTYPE html>
<html>
<head>
<title>Principal Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
font-family:Segoe UI;
background:#f4f6f9;
margin:0;
transition:0.3s;
}

/* ================= DARK MODE ================= */
.dark-mode{
background:#1a1a1a;
color:white;
}

.dark-mode .card,
.dark-mode .filters,
.dark-mode .chart-box,
.dark-mode table,
.dark-mode .teacher-section{
background:#2c2c2c;
color:white;
}

.dark-mode th{
background:#111;
}

.dark-mode td{
border-bottom:1px solid #444;
}

.dark-mode .alert{
background:#3a1f1f;
color:white;
}

/* HEADER */
.header{
background:#1e3c72;
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center
}

.header a{
color:white;
text-decoration:none;
background:#ff4d4d;
padding:8px 12px;
border-radius:6px
}

/* CONTAINER */
.container{padding:25px}

/* FILTER BOX */
.filters{
background:white;
padding:15px;
border-radius:10px;
box-shadow:0 4px 12px rgba(0,0,0,.1);
margin-bottom:25px;
display:flex;
gap:15px;
flex-wrap:wrap;
align-items:center
}

select,button,input{
padding:8px;
border-radius:6px;
border:1px solid #ccc
}

button{
background:#1e3c72;
color:white;
cursor:pointer
}

button:hover{
background:#16305c
}

/* CARDS */
.cards{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:20px;
margin-bottom:25px
}

.card{
background:white;
padding:20px;
border-radius:12px;
text-align:center;
box-shadow:0 4px 12px rgba(0,0,0,.1)
}

/* ALERT */
.alert{
background:#ffe5e5;
padding:15px;
border-left:6px solid red;
margin-bottom:25px;
border-radius:8px
}

/* CHARTS */
.chart-row{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:40px;
margin-bottom:30px
}

.chart-box{
width:300px;
height:300px;
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 4px 12px rgba(0,0,0,.1)
}

/* TABLE */
table{
width:100%;
background:white;
border-collapse:collapse;
margin-bottom:30px
}

th,td{
padding:10px;
border-bottom:1px solid #ddd;
text-align:center
}

th{
background:#1e3c72;
color:white
}

.high{color:red;font-weight:bold}
.medium{color:orange;font-weight:bold}
.low{color:green;font-weight:bold}

/* TEACHER SECTION */
.teacher-section{
background:white;
padding:20px;
border-radius:12px;
box-shadow:0 4px 12px rgba(0,0,0,.1)
}

.teacher-section h3{
margin-top:0
}

.remove-btn{
color:red;
text-decoration:none
}

.ngo-btn{
background:red;
color:white;
padding:10px 15px;
border-radius:6px;
text-decoration:none;
display:inline-block;
margin-right:10px;
margin-bottom:20px
}
</style>
</head>

<body>

<div class="header">
<h2 id="title">üìä Principal Dashboard</h2>

<div>
<select id="languageSelect" onchange="changeLanguage()" style="margin-right:10px;">
<option value="en">English</option>
<option value="mr">Marathi</option>
</select>

<button onclick="toggleDarkMode()" style="margin-right:10px;">üåô</button>

<a href="{{ url_for('logout') }}">Logout</a>
</div>
</div>

<div class="container">

<!-- FILTER SECTION -->
<form method="GET" class="filters">

<select name="class_filter">
<option value="">All Classes</option>
{% for i in range(1,9) %}
<option value="{{i}}" {% if selected_class==i|string %}selected{% endif %}>
Class {{i}}
</option>
{% endfor %}
</select>

<select name="risk_filter">
<option value="">All Risk</option>
<option value="High">High</option>
<option value="Medium">Medium</option>
<option value="Low">Low</option>
</select>

<select name="gender_filter">
<option value="">All Gender</option>
<option value="Male">Male</option>
<option value="Female">Female</option>
</select>

<button type="submit">Apply Filter</button>

</form>
<!-- ================= LAST 30 DAYS IMPROVEMENT ================= -->
<div class="cards">

<div class="card" style="border-left:6px solid green;">
<h3>üìà Improved (Last 30 Days)</h3>
<h2 style="color:green">{{ improved_students }}</h2>
</div>

<div class="card" style="border-left:6px solid red;">
<h3>üìâ Declined (Last 30 Days)</h3>
<h2 style="color:red">{{ declined_students }}</h2>
</div>

<div class="card">
<h3>üìä Improvement Rate</h3>
<h2>
{% if improved_students + declined_students > 0 %}
{{ ((improved_students / (improved_students + declined_students)) * 100)|round(1) }}%
{% else %}
0%
{% endif %}
</h2>
</div>

</div>

<!-- SUMMARY CARDS -->
 <div class="cards">

<div class="card" style="border-left:6px solid #2196F3;">
<h3>üè† Home Visits</h3>
<h2>{{ home_visits }}</h2>
</div>

<div class="card" style="border-left:6px solid #9C27B0;">
<h3>üë®‚Äçüë©‚Äçüëß Parent Meetings</h3>
<h2>{{ parent_meetings }}</h2>
</div>

<div class="card" style="border-left:6px solid orange;">
<h3>‚¨á High ‚Üí Medium</h3>
<h2>{{ high_to_medium }}</h2>
</div>

<div class="card" style="border-left:6px solid green;">
<h3>‚¨á Medium ‚Üí Low</h3>
<h2>{{ medium_to_low }}</h2>
</div>

</div>

<div class="cards">
<div class="card">
<h3>Total Students</h3>
<h2>{{ total_students }}</h2>
</div>

<div class="card">
<h3>High Risk</h3>
<h2 style="color:red">{{ high_risk }}</h2>
</div>

<div class="card">
<h3>Medium Risk</h3>
<h2 style="color:orange">{{ medium_risk }}</h2>
</div>

<div class="card">
<h3>Average Attendance</h3>
<h2>{{ avg_attendance }}%</h2>
</div>
</div>

<!-- RED FLAG -->
{% if red_flag_students %}
<div class="alert">
<b>üö® RED FLAG STUDENTS</b><br><br>
{% for s in red_flag_students %}
* {{ s }}<br>
{% endfor %}
</div>
{% endif %}

<!-- ACTION BUTTONS -->
<a href="{{ url_for('send_ngo') }}" class="ngo-btn">
Send All High Risk Students To NGO
</a>

<a href="{{ url_for('export_excel') }}" class="ngo-btn" style="background:green;">
Download Excel Report
</a>

<a href="{{ url_for('export_pdf') }}" class="ngo-btn" style="background:#1e3c72;">
Download PDF Report
</a>

<!-- CHARTS -->
<div class="chart-row">

<div class="chart-box">
<h4 style="text-align:center">Risk Distribution</h4>
<canvas id="riskChart"></canvas>
</div>

<div class="chart-box">
<h4 style="text-align:center">Class-wise High Risk</h4>
<canvas id="classChart"></canvas>
</div>

<div class="chart-box">
<h4 style="text-align:center">Boys vs Girls (High Risk)</h4>
<canvas id="genderChart"></canvas>
</div>

</div>

<!-- STUDENT TABLE -->
<h3>Student Details</h3>

<table>
<tr>
<th>Roll</th>
<th>Name</th>
<th>Class</th>
<th>Gender</th>
<th>Attendance</th>
<th>Marks</th>
<th>Risk</th>
</tr>

{% for s in students %}
<tr>
<td>{{ s[0] }}</td>
<td>{{ s[1] }}</td>
<td>{{ s[2] }}</td>
<td>{{ s[3] }}</td>
<td>{{ s[4] }}%</td>
<td>{{ s[5] }}</td>
<td class="{{ s[6]|lower }}">{{ s[6] }}</td>
</tr>
{% endfor %}
</table> 
<div class="chart-box">
<h4 style="text-align:center">Last 30 Days Trend</h4>
<canvas id="trendChart"></canvas>
</div>


<!-- TEACHER MANAGEMENT -->
<div class="teacher-section">

<h3>Teacher Management</h3>

<form method="POST" action="{{ url_for('add_teacher') }}">
<input type="text" name="name" placeholder="Teacher Name" required>
<input type="email" name="email" placeholder="Email" required>

<select name="assigned_class" required>
{% for i in range(1,9) %}
<option value="{{i}}">Class {{i}}</option>
{% endfor %}
</select>

<button type="submit">Add Teacher</button>
</form>

<br>

<table>
<tr>
<th>Name</th>
<th>Email</th>
<th>Assigned Class</th>
<th>Action</th>
</tr>

{% for t in teachers %}
<tr>
<td>{{t.name}}</td>
<td>{{t.email}}</td>
<td>Class {{t.assigned_class}}</td>
<td>
<a class="remove-btn" href="{{ url_for('remove_teacher', teacher_id=t.id) }}">
Remove
</a>
</td>
</tr>
{% endfor %}
</table>

</div>

</div>
new Chart(document.getElementById("trendChart"),{
type:"bar",
data:{
labels:["Improved","Declined"],
datasets:[{
data:[{{improved_students}},{{declined_students}}],
backgroundColor:["#4CAF50","#ff4d4d"]
}]
},
options:{plugins:{legend:{display:false}}}
});


<script>
// ================= DARK MODE =================
function toggleDarkMode(){
document.body.classList.toggle("dark-mode");
localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
}

if(localStorage.getItem("darkMode") === "true"){
document.body.classList.add("dark-mode");
}

// ================= LANGUAGE =================
const translations={
en:{title:"üìä Principal Dashboard"},
mr:{title:"üìä ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§æ‡§ß‡•ç‡§Ø‡§æ‡§™‡§ï ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°"}
};

function changeLanguage(){
const lang=document.getElementById("languageSelect").value;
document.getElementById("title").innerText=translations[lang].title;
localStorage.setItem("language",lang);
}

const savedLang=localStorage.getItem("language");
if(savedLang){
document.getElementById("languageSelect").value=savedLang;
changeLanguage();
}

// ================= CHARTS =================
new Chart(document.getElementById("riskChart"),{
type:"pie",
data:{
labels:["High","Medium","Low"],
datasets:[{
data:[
{{high_risk}},
{{medium_risk}},
{{total_students-high_risk-medium_risk}}
],
backgroundColor:["#ff4d4d","#ffa500","#4CAF50"]
}]
}
});

new Chart(document.getElementById("classChart"),{
type:"bar",
data:{
labels:{{class_labels|tojson}},
datasets:[{
label:"High Risk",
data:{{class_values|tojson}},
backgroundColor:"#ff4d4d"
}]
},
options:{plugins:{legend:{display:false}}}
});

new Chart(document.getElementById("genderChart"),{
type:"doughnut",
data:{
labels:["Boys","Girls"],
datasets:[{
data:[{{boys_risk}},{{girls_risk}}],
backgroundColor:["#4287f5","#ff66cc"]
}]
}
});
</script>

</body>
</html>