{% extends "teacher/base.html" %}
{% block title %}Edit Student - EduDrop{% endblock %}
{% block content %}

<div class="card">
  <h5 style="font-weight:600;margin-bottom:20px;">Edit Student</h5>

  <form method="POST">
    <!-- Basic Details -->
    <h6 style="font-weight:600;margin-bottom:12px;color:var(--primary);">Basic Details</h6>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Name</label>
        <input type="text" name="name" class="form-control" value="{{ student.name }}" required>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control" value="{{ student.email or '' }}">
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 mb-3">
        <label class="form-label">Roll Number</label>
        <input type="number" name="roll" class="form-control" value="{{ student.roll }}" required>
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">Standard</label>
        <select name="standard" class="form-control" required>
          {% for i in range(1,9) %}
          <option value="{{ i }}" {% if student.standard|string == i|string %}selected{% endif %}>{{ i }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">Division</label>
        <select name="division" class="form-control" required>
          {% for d in ['A','B','C','D','E','F'] %}
          <option {% if student.division == d %}selected{% endif %}>{{ d }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">Gender</label>
        <select name="gender" class="form-control">
          <option value="">Select</option>
          {% for g in ['Male','Female','Other'] %}
          <option {% if student.gender == g %}selected{% endif %}>{{ g }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- Academic Performance -->
    <h6 style="font-weight:600;margin:20px 0 12px;color:var(--primary);">Academic Performance</h6>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Monthly Test Score</label>
        <input type="number" name="monthly_test_score" class="form-control" value="{{ student.monthly_test_score or '' }}" min="0" max="100">
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Overall Attendance %</label>
        <input type="number" name="attendance" class="form-control" value="{{ student.attendance or '' }}" min="0" max="100">
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Assignment Status</label>
        <select name="assignment" class="form-control">
          {% for opt in ['Completed','Not Completed'] %}
          <option {% if student.assignment == opt %}selected{% endif %}>{{ opt }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Quiz Performance</label>
        <select name="quiz" class="form-control">
          {% for opt in ['Good','Average','Poor'] %}
          <option {% if student.quiz == opt %}selected{% endif %}>{{ opt }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Behaviour</label>
        <input type="text" name="behaviour" class="form-control" value="{{ student.behaviour or '' }}" maxlength="150" placeholder="Max 25 words">
      </div>
    </div>

    <!-- Subjects & Per-Subject Attendance -->
    <h6 style="font-weight:600;margin:20px 0 12px;color:var(--primary);">Subjects & Per-Subject Attendance</h6>
    <div id="subjectContainer">
      {% for sub in student.subjects or [] %}
      <div class="row mb-2 subject-row">
        <div class="col-md-5">
          <input type="text" name="subjects[]" class="form-control" value="{{ sub.subject }}" placeholder="Subject Name">
        </div>
        <div class="col-md-5">
          <input type="number" name="sub_attendance[]" class="form-control" value="{{ sub.attendance }}" min="0" max="100" placeholder="Attendance %">
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-outline" style="color:var(--danger);border-color:var(--danger);padding:6px 12px;" onclick="this.closest('.subject-row').remove()">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
      {% endfor %}
    </div>
    <button type="button" class="btn btn-outline mb-4" onclick="addSubject()">
      <i class="bi bi-plus-circle"></i> Add Subject
    </button>

    <!-- Parent Information -->
    <h6 style="font-weight:600;margin:20px 0 12px;color:var(--primary);">Parent Information</h6>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Parent Name</label>
        <input type="text" name="parent_name" class="form-control" value="{{ student.parent_name or '' }}">
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Parent Phone</label>
        <input type="text" name="parent_phone" class="form-control" value="{{ student.parent_phone or '' }}">
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Alternate Phone</label>
        <input type="text" name="parent_alt_phone" class="form-control" value="{{ student.parent_alt_phone or '' }}">
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Address</label>
        <input type="text" name="parent_address" class="form-control" value="{{ student.parent_address or '' }}">
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle"></i> Update Student</button>
      <a href="{{ url_for('student_records') }}" class="btn btn-outline">Cancel</a>
    </div>
  </form>
</div>

<script>
function addSubject() {
  var c = document.getElementById('subjectContainer');
  var d = document.createElement('div');
  d.className = "row mb-2 subject-row";
  d.innerHTML = '<div class="col-md-5"><input type="text" name="subjects[]" placeholder="Subject Name" class="form-control"></div><div class="col-md-5"><input type="number" name="sub_attendance[]" placeholder="Attendance %" class="form-control" min="0" max="100"></div><div class="col-md-2"><button type="button" class="btn btn-outline" style="color:var(--danger);border-color:var(--danger);padding:6px 12px;" onclick="this.closest(\'.subject-row\').remove()"><i class="bi bi-trash"></i></button></div>';
  c.appendChild(d);
}
</script>

{% endblock %}
